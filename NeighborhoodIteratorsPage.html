<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="https://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ITK: Neighborhood Iterators</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js"></script>
<script type="text/javascript" src="build_text.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ITKDoxygenStyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="itkLogoSmall.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ITK
   &#160;<span id="projectnumber">6.0.0</span>
   </div>
   <div id="projectbrief">Insight Toolkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!--  Scripts intended to allow users to submit patches with documentation fixes -->
<!-- <script src="https://www.itk.org/Doxygen/js/jquery-1.4.3.min.js" type="text/javascript" charset="utf-8"></script> -->
<!-- <script src="https://www.itk.org/Doxygen/js/editdoxygen.js" type="text/javascript" charset="utf-8"></script> -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Neighborhood Iterators </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="IntroductionSection"></a>
Introduction</h1>
<p >This document provides a general overview of the intended use of the NeighborhoodIterator classes and their associated objects for low-level image processing in Itk. For a more detailed description of the API, please refer to the inline Itk documentation and manual.</p>
<dl class="section user"><dt></dt><dd>Neighborhood iterators are the abstraction of the concept of <em>locality</em> in image processing. They are designed to be used in algorithms that perform calculations on a neighborhood of pixel values around a point in an image. For example, a classic neighborhood-based operation is to compute the mean of a set of pixels in order to reduce noise in an image. This is typically done by taking a region of 3x3 pixels and computing the average of their values. A new image with fewer narrow high frequency spikes (noise) is produced using the resulting means.</dd></dl>
<dl class="section user"><dt></dt><dd>This code in classical <em>texbook</em> notation can look like:</dd></dl>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> nx = 512;</div>
<div class="line"><span class="keywordtype">int</span> ny = 512;</div>
<div class="line">ImageType image(nx,ny);</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> x=1; x&lt;nx-1; x++)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">float</span> sum = 0;</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y=1; y&lt;ny-1; y++)</div>
<div class="line">  {</div>
<div class="line">    sum += image(x-1,y-1) + image(x  ,y-1) + image(x+1,y-1);</div>
<div class="line">    sum += image(x-1,y  ) + image(x  ,y  ) + image(x+1,y  );</div>
<div class="line">    sum += image(x-1,y+1) + image(x  ,y+1) + image(x+1,y+1);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>The code above is readable and straightforward to implement. But its efficiency is limited to the speed of random access into the image. It also assumes a two dimensional image. We can eliminate the random access bottleneck by using iterators to dereference pixels, and for a two-dimensional image, code-readability may not suffer much. But what if we want code for three or more dimensions? Before long, the code size and complexity will increase to unmanageable levels. In Itk, we have encapsulated this functionality for efficiency, readability, and reusability.</dd></dl>
<h1><a class="anchor" id="NeighborhoodIteratorsSection"></a>
Neighborhood iterators</h1>
<p ><a class="el" href="classitk_1_1Image.html" title="Templated n-dimensional image class.">itk::Image</a> neighborhood iteration and dereferencing is encapsulated in the <a class="el" href="classitk_1_1NeighborhoodIterator.html" title="Defines iteration of a local N-dimensional neighborhood of pixels across an itk::Image.">itk::NeighborhoodIterator</a> classes. ITK NeighborhoodIterators allow for code that is closer to the algorithmic abstraction,</p>
<div class="fragment"><div class="line">ForAllTheIndicies i in Image</div>
<div class="line">   GetTheNeighbors n in a 3x3 region around i</div>
<div class="line">     Compute the mean of all pixels n</div>
<div class="line">       Write the value to the output at i</div>
</div><!-- fragment --><p >Here is how the pseudocode above can be rewritten in ITK using neighborhood iterators: ( In the code examples that follow, some template parameters may have been omitted for clarity. )</p>
<div class="fragment"><div class="line">1   <span class="keyword">using</span> ImageType = <a class="code hl_class" href="classitk_1_1Image.html">itk::Image&lt;float, 2&gt;</a>;</div>
<div class="line">2   <span class="keyword">using</span> NeighborhoodIterator = itk::SmartNeighborhoodIterator&lt;ImageType&gt;;</div>
<div class="line">3   <span class="keyword">using</span> ImageIterator = <a class="code hl_class" href="classitk_1_1ImageRegionIterator.html">itk::ImageRegionIterator&lt;ImageType&gt;</a>;</div>
<div class="line">4</div>
<div class="line">5   <a class="code hl_typedef" href="itkAddImageFilter_8h.html#ac831674d6d3f7cd2148ae944cbaa7c9d">ImageType::Pointer</a> input_image  = GetImageSomehow();</div>
<div class="line">6   <a class="code hl_typedef" href="itkAddImageFilter_8h.html#ac831674d6d3f7cd2148ae944cbaa7c9d">ImageType::Pointer</a> output_image = GetImageSomehow();</div>
<div class="line">7</div>
<div class="line">8   <span class="comment">// A radius of 1 in all axial directions gives a 3x3x3x3x... neighborhood.</span></div>
<div class="line">9   NeighborhoodIterator::RadiusType radius;</div>
<div class="line">10  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; ImageType::ImageDimension; ++i) radius[i] = 1;</div>
<div class="line">11</div>
<div class="line">12  <span class="comment">// Initializes the iterators on the input &amp; output image regions</span></div>
<div class="line">13  NeighborhoodIterator it(radius, input_image,</div>
<div class="line">14                                  output_image-&gt;GetRequestedRegion());</div>
<div class="line">15  ImageIterator out(output_image, output_image-&gt;GetRequestedRegion());</div>
<div class="line">16</div>
<div class="line">17  <span class="comment">// Iterates over the input and output</span></div>
<div class="line">18  <span class="keywordflow">for</span> (it.SetToBegin(), out = out.Begin(); ! it.IsAtEnd(); ++it, ++out )</div>
<div class="line">19    {</div>
<div class="line">20      <span class="keywordtype">float</span> accum = 0.0;</div>
<div class="line">21      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; it.Size(); ++i)</div>
<div class="line">22        {</div>
<div class="line">23          accum += it.GetPixel(i);</div>
<div class="line">24        }</div>
<div class="line">25      out.Set(accum/(<span class="keywordtype">float</span>)(it.Size()));</div>
<div class="line">26    }</div>
<div class="ttc" id="aclassitk_1_1ImageRegionIterator_html"><div class="ttname"><a href="classitk_1_1ImageRegionIterator.html">itk::ImageRegionIterator</a></div><div class="ttdoc">A multi-dimensional iterator templated over image type that walks a region of pixels.</div><div class="ttdef"><b>Definition:</b> <a href="itkImageRegionIterator_8h_source.html#l00080">itkImageRegionIterator.h:81</a></div></div>
<div class="ttc" id="aclassitk_1_1Image_html"><div class="ttname"><a href="classitk_1_1Image.html">itk::Image</a></div><div class="ttdoc">Templated n-dimensional image class.</div><div class="ttdef"><b>Definition:</b> <a href="itkImage_8h_source.html#l00088">itkImage.h:89</a></div></div>
<div class="ttc" id="aitkAddImageFilter_8h_html_ac831674d6d3f7cd2148ae944cbaa7c9d"><div class="ttname"><a href="itkAddImageFilter_8h.html#ac831674d6d3f7cd2148ae944cbaa7c9d">Pointer</a></div><div class="ttdeci">SmartPointer&lt; Self &gt; Pointer</div><div class="ttdef"><b>Definition:</b> <a href="itkAddImageFilter_8h_source.html#l00093">itkAddImageFilter.h:93</a></div></div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>Note that the computational work is confined to lines 18-26. The code is also completely generalized for multiple dimensions. For example, changing line 1 to: <div class="fragment"><div class="line">1   <span class="keyword">using</span> ImageType = <a class="code hl_class" href="classitk_1_1Image.html">itk::Image&lt;float, 5&gt;</a>;</div>
</div><!-- fragment --> produces an averaging filter for five-dimensional images.</dd></dl>
<dl class="section user"><dt></dt><dd>The values in the neighborhood are dereferenced through the GetPixel(n) method of the iterator. Think of the iterator as a C array, storing neighborhood values in the same order that they are stored in the image, with the lowest dimension as the fastest increasing dimension.</dd></dl>
<h1><a class="anchor" id="OperatorsOperationsSection"></a>
Neighborhood operators and operations</h1>
<p >NeighborhoodOperators are container classes for generating and storing computational kernels such as LaPlacian, Gaussian, derivative, and morphological operators. They provide a generalized interface for creation and access of the operator coefficients.</p>
<dl class="section user"><dt></dt><dd>Applying a NeighborhoodOperator to a NeighborhoodIterator requires defining some sort of operation. One common case is that of convolution with a kernel of coefficients. In Itk, convolution filtering of an image can be done in just a few lines of code using an inner product operation between a neighborhood iterator and an operator. The following convolution with a LaPlacian kernel demonstrates this concept.</dd></dl>
<div class="fragment"><div class="line">1  LaPlacianOperator&lt;double, 3&gt; OP;</div>
<div class="line">2  ImageIterator out( outputImage, regionToProcess );</div>
<div class="line">3  NeighborhoodIterator it ( OP.GetRadius(), inputImage, regionToProcess );</div>
<div class="line">4  NeighborhoodInnerProduct IP;</div>
<div class="line">5</div>
<div class="line">6  out = out.Begin();</div>
<div class="line">7  <span class="keywordflow">for</span> (it.SetToBegin(); it != it.End(); ++it, ++out)</div>
<div class="line">8  {</div>
<div class="line">9    out.Set( IP( it, OP) );</div>
<div class="line">10 }</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>Sometimes it may be more appropriate and efficient to work outside of the operator/operation model. The mean calculation above is one example. A `&lsquo;half&rsquo;' directional derivative, shown below, is another example.</dd></dl>
<div class="fragment"><div class="line">1  NeighborhoodIterator::RadiusType radius = {1, 0, 0};</div>
<div class="line">2  NeighborhoodIterator it(radius, inputImage, regionToProcess)</div>
<div class="line">3  ImageRegionIterator out( outputImage, regionToProcess );</div>
<div class="line">4  <span class="keywordflow">for</span> (it.SetToBegin(); it != it.End(); ++it, ++out)</div>
<div class="line">5  {</div>
<div class="line">6    out.Set( it.GetPixel(3) - it.GetPixel(2) );</div>
<div class="line">7  }</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>In this example the neighborhood is defined as a three pixel strip with width along only the first axis. Mapping the spatial orientation of neighborhood pixels to the array location is the responsibility of the code writer. Some methods such as GetStride(n), which returns the stride length in pixels along an axis n, have been provided to help in coding algorithms for arbitrary dimensionality. The index of the center pixel in a neighborhood is always Size()/2.</dd></dl>
<h1><a class="anchor" id="ImageBoundariesSection"></a>
Calculations at image boundaries</h1>
<p >For any neighborhood operation, conditions at data set boundaries become important. SmartNeighborhoodIterator defines a special class of neighborhood iterators that transparently handle boundary conditions. These iterators store a boundary condition object that is used to calculate a value of requested pixel indices that lie outside the data set boundary. New boundary condition objects can be defined by a user and plugged into SmartNeighboroodIterators as is appropriate for their algorithm.</p>
<dl class="section user"><dt></dt><dd>A SmartNeighborhoodIterator can be used in place of NeighborhoodIterator to iterate over an entire image region, but it will incur a penalty on performance. For this reason, it is desirable to process the image differently over distinct boundary and non-boundary regions. Itk's definition of image regions makes this easy to manage. The process is as follows: first apply the algorithm over all neighborhoods not on the image boundary using the fast NeighborhoodIterator, then process each region on the boundary using the SmartNeighborhoodIterator. The size of the boundary regions are defined by the radius of the neighborhood that you are using.</dd></dl>
<dl class="section user"><dt></dt><dd>Rewriting the inner product code using this approach looks like the following. (Here we are using the default SmartNeighborhoodIterator boundary condition and omitting some template parameters for simplicity.)</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">using</span> RegionFinderType = NeighborhoodAlgorithm::ImageBoundaryFacesCalculator;</div>
<div class="line"> </div>
<div class="line">LaPlacianOperator&lt;double, InputImageType::ImageDimension&gt; OP;</div>
<div class="line"> </div>
<div class="line">RegionFinderType regionCalculator;</div>
<div class="line">RegionFinderType::FaceListType regions;</div>
<div class="line">RegionFinderType::FaceListType::iterator regions_iterator;</div>
<div class="line"> </div>
<div class="line">regions = regionCalculator( inputImage, regionToProcess, it.GetRadius() );</div>
<div class="line">regions_iterator = regions.begin();</div>
<div class="line"> </div>
<div class="line">ImageIterator out;</div>
<div class="line"> </div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Process non-boundary regions normally.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">out = ImageIterator(outputImage, *regions_iterator);</div>
<div class="line">NeighborhoodIterator it (OP.GetRadius(), inputImage, *regions_iterator);</div>
<div class="line">NeighborhoodInnerProduct IP;</div>
<div class="line">out = out.Begin();</div>
<div class="line"><span class="keywordflow">for</span> (it.SetToBegin(); it != it.End(); ++it, ++out)</div>
<div class="line">{</div>
<div class="line">  out.Set( IP( it, OP) );</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Process each boundary region with boundary conditions.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">SmartNeighborhoodInnerProduct SIP;</div>
<div class="line">SmartNeighborhoodIterator sit;</div>
<div class="line"><span class="keywordflow">for</span> (regions_iterator++ ; regions_iterator != regions.end(); regions_iterator++)</div>
<div class="line">{</div>
<div class="line">  out = ImageIterator(outputImage, *regions_iterator);</div>
<div class="line">  sit = SmartNeighborhoodIterator(OP.GetRadius(), inputImage, *regions_iterator);</div>
<div class="line">  <span class="keywordflow">for</span> (sit.SetToBegin(); sit != sit.End(); ++sit, ++out)</div>
<div class="line">  {</div>
<div class="line">    out.Set( SIP( sit, OP) );</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>The NeighborhoodAlgorithm::ImageBoundaryFacesCalculator is a special function object that returns a list of sub-regions, or faces, of an image region. The first region in the list corresponds to all the non-boundary pixels in the input image region. Subsequent regions in the list represent all of the boundary faces of the image (because an image region is defined only by a single index and size, no single composite boundary region is possible). The list is traversed with an iterator.</dd></dl>
<h1><a class="anchor" id="FurtherInformationSection"></a>
Further information</h1>
<p >Many filters in Itk use the neighborhood iterators and operators. Some canonical examples of their use include the class of AnisotropicDiffusionFunctions and the morphological image filters. itk::WatershedSegmenter also makes extensive use of the neighborhood iterators.</p>
<dl class="section user"><dt></dt><dd>The best documentation of the API for these objects is are the class definitions themselves, since the API is subject to change as the toolkit matures and is refined. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<hr class="footer"/>
<div class="footer" align="left">
  <small>Tarballs of the nightly generated Doxygen documentation are available
    for the
    <a href="https://itk.org/files/NightlyDoxygen/InsightDoxygenDocHtml.tar.gz">html</a>,
    <a href="https://itk.org/files/NightlyDoxygen/InsightDoxygenDocXml.tar.gz">xml</a>, and
    <a href="https://itk.org/files/NightlyDoxygen/InsightDoxygenDocTag.gz">tag file</a>.
  Previous versions of this documentation for version:
    <a href="https://itk.org/Doxygen53/html/index.html">5.3</a>,
    <a href="https://itk.org/Doxygen52/html/index.html">5.2</a>,
    <a href="https://itk.org/Doxygen51/html/index.html">5.1</a>,
    <a href="https://itk.org/Doxygen50/html/index.html">5.0</a>,
    <a href="https://itk.org/Doxygen413/html/index.html">4.13</a>,
    <a href="https://itk.org/Doxygen320/html/index.html">3.20</a>.
  </small>
</div>
<address class="footer"><small>
Generated on <span id="datetime">unknown</span> for ITK by &#160;
<a href="https://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.9.3
</small></address>
</body>
</html>
