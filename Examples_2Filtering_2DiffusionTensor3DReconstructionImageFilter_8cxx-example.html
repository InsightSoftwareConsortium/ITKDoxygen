<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="https://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ITK: Examples/Filtering/DiffusionTensor3DReconstructionImageFilter.cxx</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js"></script>
<script type="text/javascript" src="build_text.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ITKDoxygenStyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="itkLogoSmall.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ITK
   &#160;<span id="projectnumber">6.0.0</span>
   </div>
   <div id="projectbrief">Insight Toolkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!--  Scripts intended to allow users to submit patches with documentation fixes -->
<!-- <script src="https://www.itk.org/Doxygen/js/jquery-1.4.3.min.js" type="text/javascript" charset="utf-8"></script> -->
<!-- <script src="https://www.itk.org/Doxygen/js/editdoxygen.js" type="text/javascript" charset="utf-8"></script> -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Examples/Filtering/DiffusionTensor3DReconstructionImageFilter.cxx</div></div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*=========================================================================</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  Copyright NumFOCUS</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><span class="comment"> *  you may not use this file except in compliance with the License.</span></div>
<div class="line"><span class="comment"> *  You may obtain a copy of the License at</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *         https://www.apache.org/licenses/LICENSE-2.0.txt</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><span class="comment"> *  See the License for the specific language governing permissions and</span></div>
<div class="line"><span class="comment"> *  limitations under the License.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *=========================================================================*/</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This example shows how to use the</span></div>
<div class="line"><span class="comment">// DiffusionTensor3DReconstructionImageFilter to reconstruct an image of</span></div>
<div class="line"><span class="comment">// tensors from Diffusion weighted images. See the documentation of</span></div>
<div class="line"><span class="comment">// DiffusionTensor3DReconstructionImageFilter,</span></div>
<div class="line"><span class="comment">// TensorRelativeAnisotropyImageFilter, TensorFractionalAnisotropyImageFilter</span></div>
<div class="line"><span class="comment">// first.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// The example takes diffusion weighted images in the Nrrd format, writes out</span></div>
<div class="line"><span class="comment">// the gradient and reference images for the users reference and computes and</span></div>
<div class="line"><span class="comment">// writes out the Fractional Anisotropy and Relative Anisotropy images.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// The easiest way to get started is to try out the filter on a sample</span></div>
<div class="line"><span class="comment">// dataset.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Acquiring sample datasets:</span></div>
<div class="line"><span class="comment">//  1. Get the DWI datasets from</span></div>
<div class="line"><span class="comment">//        ftp://public.kitware.com/pub/namic/DTI/Data/dwi.nhdr</span></div>
<div class="line"><span class="comment">//        ftp://public.kitware.com/pub/namic/DTI/Data/dwi.img.gz (gunzip this)</span></div>
<div class="line"><span class="comment">//     These datasets contain a reference T1 image and 30 diffusion weighted</span></div>
<div class="line"><span class="comment">//     images. See the nrrd header for details such as B value etc.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  2. Run the example with the following args</span></div>
<div class="line"><span class="comment">//       dwi.nhdr 80 Tensors.mhd FractionalAnisotropy.mhd</span></div>
<div class="line"><span class="comment">//       RelativeAnisotropy.mhd 1</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  3. You should find 30 gradient images, 1 reference image, the FA and RA</span></div>
<div class="line"><span class="comment">//  images</span></div>
<div class="line"><span class="comment">//     in your working directory, which you can fire up in your favourite</span></div>
<div class="line"><span class="comment">//     volume browser.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This work is part of the National Alliance for Medical Image</span></div>
<div class="line"><span class="comment">// Computing (NAMIC), funded by the National Institutes of Health</span></div>
<div class="line"><span class="comment">// through the NIH Roadmap for Medical Research, Grant U54 EB005149.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Additional documentation: For details on the Nrrd format for DTI, see</span></div>
<div class="line"><span class="comment">// https://wiki.na-mic.org/Wiki/index.php/NAMIC_Wiki:DTI:Nrrd_format</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="itkDiffusionTensor3DReconstructionImageFilter_8h.html">itkDiffusionTensor3DReconstructionImageFilter.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="itkTensorFractionalAnisotropyImageFilter_8h.html">itkTensorFractionalAnisotropyImageFilter.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="itkTensorRelativeAnisotropyImageFilter_8h.html">itkTensorRelativeAnisotropyImageFilter.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="itkNrrdImageIO_8h.html">itkNrrdImageIO.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="itkImageSeriesReader_8h.html">itkImageSeriesReader.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="itkImageFileWriter_8h.html">itkImageFileWriter.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="itkImageRegionIterator_8h.html">itkImageRegionIterator.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (argc &lt; 3)</div>
<div class="line">  {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; argv[0]</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; NrrdFileName(.nhdr) threshold(on B0)&quot;</span></div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; FAImageFileName RelativeAnisotropyFileName &quot;</span></div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;[ExtractGradientAndReferenceImage from the NRRD file and &quot;</span></div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;write them as images]&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;\tExample args: xt_dwi.nhdr 80 FA.mhd 1&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">constexpr</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a id="a0" name="a0"></a><a class="code hl_variable" href="namespaceitk_1_1GTest_1_1TypedefsAndConstructors_1_1Dimension2.html#a3c1343e7d285fc01106df9e0c28d5154">Dimension</a> = 3;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>           numberOfImages = 0;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>           numberOfGradientImages = 0;</div>
<div class="line">  <span class="keywordtype">bool</span>                   readb0 = <span class="keyword">false</span>;</div>
<div class="line">  <span class="keywordtype">double</span>                 b0 = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> PixelType = <span class="keywordtype">unsigned</span> short;</div>
<div class="line">  <span class="keyword">using</span> ImageType = <a id="_a1" name="_a1"></a><a class="code hl_class" href="classitk_1_1VectorImage.html">itk::VectorImage&lt;unsigned short, 3&gt;</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> reader = <a id="a2" name="a2"></a><a class="code hl_function" href="classitk_1_1ImageFileReader.html#ac90899aba4a68053e9ea5bc3860ed442">itk::ImageFileReader&lt;ImageType&gt;::New</a>();</div>
<div class="line"> </div>
<div class="line">  <a id="a3" name="a3"></a><a class="code hl_typedef" href="itkAddImageFilter_8h.html#ac831674d6d3f7cd2148ae944cbaa7c9d">ImageType::Pointer</a> img;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Set the properties for NrrdReader</span></div>
<div class="line">  reader-&gt;SetFileName(argv[1]);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Read in the nrrd data. The file contains the reference image and the</span></div>
<div class="line">  <span class="comment">// gradient images.</span></div>
<div class="line">  <span class="keywordflow">try</span></div>
<div class="line">  {</div>
<div class="line">    reader-&gt;Update();</div>
<div class="line">    img = reader-&gt;GetOutput();</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a id="_a4" name="_a4"></a><a class="code hl_class" href="classitk_1_1ExceptionObject.html">itk::ExceptionObject</a> &amp; ex)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; ex &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Here we instantiate the DiffusionTensor3DReconstructionImageFilter class.</span></div>
<div class="line">  <span class="comment">// The class is templated over the pixel types of the reference, gradient</span></div>
<div class="line">  <span class="comment">// and the to be created tensor pixel&#39;s precision. (We use double here). It</span></div>
<div class="line">  <span class="comment">// takes as input the Reference (B0 image acquired in the absence of</span></div>
<div class="line">  <span class="comment">// diffusion sensitizing gradients), &#39;n&#39; Gradient images and their</span></div>
<div class="line">  <span class="comment">// directions and produces as output an image of tensors with pixel-type</span></div>
<div class="line">  <span class="comment">// DiffusionTensor3D.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keyword">using</span> TensorReconstructionImageFilterType = itk::</div>
<div class="line">    DiffusionTensor3DReconstructionImageFilter&lt;PixelType, PixelType, double&gt;;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="comment">// -------------------------------------------------------------------------</span></div>
<div class="line">  <span class="comment">// Parse the Nrrd headers to get the B value and the gradient directions</span></div>
<div class="line">  <span class="comment">// used for diffusion weighting.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// The Nrrd headers should look like :</span></div>
<div class="line">  <span class="comment">// The tags specify the B value and the gradient directions. If gradient</span></div>
<div class="line">  <span class="comment">// directions are (0,0,0), it indicates that it is a reference image.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// DWMRI_b-value:=800</span></div>
<div class="line">  <span class="comment">// DWMRI_gradient_0000:= 0 0 0</span></div>
<div class="line">  <span class="comment">// DWMRI_gradient_0001:=-1.000000       0.000000        0.000000</span></div>
<div class="line">  <span class="comment">// DWMRI_gradient_0002:=-0.166000       0.986000        0.000000</span></div>
<div class="line">  <span class="comment">// DWMRI_gradient_0003:=0.110000        0.664000        0.740000</span></div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keyword">const</span> <a id="_a5" name="_a5"></a><a class="code hl_class" href="classitk_1_1MetaDataDictionary.html">itk::MetaDataDictionary</a> imgMetaDictionary =</div>
<div class="line">    img-&gt;GetMetaDataDictionary();</div>
<div class="line">  std::vector&lt;std::string&gt; imgMetaKeys = imgMetaDictionary.<a id="a6" name="a6"></a><a class="code hl_function" href="classitk_1_1MetaDataDictionary.html#a9b8fc0f9c50eafe40b80c61bcf6d138c">GetKeys</a>();</div>
<div class="line">  std::vector&lt;std::string&gt;::const_iterator itKey = imgMetaKeys.begin();</div>
<div class="line">  std::string                              metaString;</div>
<div class="line"> </div>
<div class="line">  TensorReconstructionImageFilterType::GradientDirectionType vect3d;</div>
<div class="line">  <span class="keyword">const</span> TensorReconstructionImageFilterType::GradientDirectionContainerType::</div>
<div class="line">    Pointer DiffusionVectors = <a id="a7" name="a7"></a><a class="code hl_function" href="itkAddImageFilter_8h.html#a3a600dc8aa7dad7b4c1e9d190d4f8c92">TensorReconstructionImageFilterType::</a></div>
<div class="line"><a class="code hl_function" href="itkAddImageFilter_8h.html#a3a600dc8aa7dad7b4c1e9d190d4f8c92">      GradientDirectionContainerType::New</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (; itKey != imgMetaKeys.end(); ++itKey)</div>
<div class="line">  {</div>
<div class="line"> </div>
<div class="line">    itk::ExposeMetaData&lt;std::string&gt;(imgMetaDictionary, *itKey, metaString);</div>
<div class="line">    <span class="keywordflow">if</span> (itKey-&gt;find(<span class="stringliteral">&quot;DWMRI_gradient&quot;</span>) != std::string::npos)</div>
<div class="line">    {</div>
<div class="line">      std::cout &lt;&lt; *itKey &lt;&lt; <span class="stringliteral">&quot; ---&gt; &quot;</span> &lt;&lt; metaString &lt;&lt; std::endl;</div>
<div class="line">      sscanf(metaString.c_str(),</div>
<div class="line">             <span class="stringliteral">&quot;%lf %lf %lf\n&quot;</span>,</div>
<div class="line">             &amp;(vect3d[0]),</div>
<div class="line">             &amp;(vect3d[1]),</div>
<div class="line">             &amp;(vect3d[2]));</div>
<div class="line">      DiffusionVectors-&gt;InsertElement(numberOfImages, vect3d);</div>
<div class="line">      ++numberOfImages;</div>
<div class="line">      <span class="comment">// If the direction is 0.0, this is a reference image</span></div>
<div class="line">      <span class="keywordflow">if</span> (vect3d[0] == 0.0 &amp;&amp; vect3d[1] == 0.0 &amp;&amp; vect3d[2] == 0.0)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">continue</span>;</div>
<div class="line">      }</div>
<div class="line">      ++numberOfGradientImages;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (itKey-&gt;find(<span class="stringliteral">&quot;DWMRI_b-value&quot;</span>) != std::string::npos)</div>
<div class="line">    {</div>
<div class="line">      std::cout &lt;&lt; *itKey &lt;&lt; <span class="stringliteral">&quot; ---&gt; &quot;</span> &lt;&lt; metaString &lt;&lt; std::endl;</div>
<div class="line">      readb0 = <span class="keyword">true</span>;</div>
<div class="line">      b0 = std::stod(metaString.c_str());</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Number of gradient images: &quot;</span> &lt;&lt; numberOfGradientImages</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; and Number of reference images: &quot;</span></div>
<div class="line">            &lt;&lt; numberOfImages - numberOfGradientImages &lt;&lt; std::endl;</div>
<div class="line">  <span class="keywordflow">if</span> (!readb0)</div>
<div class="line">  {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;BValue not specified in header file&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="comment">// -------------------------------------------------------------------------</span></div>
<div class="line">  <span class="comment">// Extract the Reference and gradient images from the NRRD file</span></div>
<div class="line">  <span class="comment">// as separate images.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// This is not really necessary, the filter is capable of gobbling the</span></div>
<div class="line">  <span class="comment">// entire VectorImage (which contains the reference and the gradient image)</span></div>
<div class="line">  <span class="comment">// and chew on it to generate the TensorImage. This is a more intuitive</span></div>
<div class="line">  <span class="comment">// formalism since this is what is usually obtained from the Nrrd DWI</span></div>
<div class="line">  <span class="comment">// format.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Nevertheless, we go through the &quot;unnecessary pain&quot; of extracting the</span></div>
<div class="line">  <span class="comment">// gradient and reference images in separate images and writing them out to</span></div>
<div class="line">  <span class="comment">// files, so they can be fired up in your favourite volume viewer.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keyword">using</span> ReferenceImageType = <a id="_a8" name="_a8"></a><a class="code hl_class" href="classitk_1_1Image.html">itk::Image&lt;PixelType, Dimension&gt;</a>;</div>
<div class="line">  <span class="keyword">using</span> GradientImageType = ReferenceImageType;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// A container of smart pointers to images. This container will hold</span></div>
<div class="line">  <span class="comment">// the &#39;numberOfGradientImages&#39; gradient images and the reference image.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  std::vector&lt;GradientImageType::Pointer&gt; imageContainer;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// iterator to iterate over the DWI Vector image just read in.</span></div>
<div class="line">  <span class="keyword">using</span> DWIIteratorType = <a id="_a9" name="_a9"></a><a class="code hl_class" href="classitk_1_1ImageRegionConstIterator.html">itk::ImageRegionConstIterator&lt;ImageType&gt;</a>;</div>
<div class="line">  DWIIteratorType dwiit(img, img-&gt;GetBufferedRegion());</div>
<div class="line">  <span class="keyword">using</span> IteratorType = <a id="_a10" name="_a10"></a><a class="code hl_class" href="classitk_1_1ImageRegionIterator.html">itk::ImageRegionIterator&lt;GradientImageType&gt;</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// In this for loop, we will extract the &#39;n&#39; gradient images + 1 reference</span></div>
<div class="line">  <span class="comment">// image from the DWI Vector image.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; numberOfImages; ++i)</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">auto</span> image = <a class="code hl_function" href="itkAddImageFilter_8h.html#a3a600dc8aa7dad7b4c1e9d190d4f8c92">GradientImageType::New</a>();</div>
<div class="line">    image-&gt;CopyInformation(img);</div>
<div class="line">    image-&gt;SetBufferedRegion(img-&gt;GetBufferedRegion());</div>
<div class="line">    image-&gt;SetRequestedRegion(img-&gt;GetRequestedRegion());</div>
<div class="line">    image-&gt;Allocate();</div>
<div class="line"> </div>
<div class="line">    IteratorType it(image, image-&gt;GetBufferedRegion());</div>
<div class="line">    dwiit.GoToBegin();</div>
<div class="line">    it.GoToBegin();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (!it.IsAtEnd())</div>
<div class="line">    {</div>
<div class="line">      it.Set(dwiit.Get()[i]);</div>
<div class="line">      ++it;</div>
<div class="line">      ++dwiit;</div>
<div class="line">    }</div>
<div class="line">    imageContainer.push_back(image);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// If we need to write out the reference and gradient images to a file..</span></div>
<div class="line">  <span class="comment">// Easier viewing them with a viewer than if they were in a single NRRD</span></div>
<div class="line">  <span class="comment">// file</span></div>
<div class="line">  <span class="keywordflow">if</span> ((argc &gt; 4) &amp;&amp; (std::stoi(argv[6])))</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> referenceImageIndex = 0;</div>
<div class="line">    <span class="keyword">using</span> GradientWriterType = <a id="_a11" name="_a11"></a><a class="code hl_class" href="classitk_1_1ImageFileWriter.html">itk::ImageFileWriter&lt;GradientImageType&gt;</a>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; numberOfImages; ++i)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">auto</span> gradientWriter = <a class="code hl_function" href="itkAddImageFilter_8h.html#a3a600dc8aa7dad7b4c1e9d190d4f8c92">GradientWriterType::New</a>();</div>
<div class="line">      gradientWriter-&gt;SetInput(imageContainer[i]);</div>
<div class="line">      <span class="keywordtype">char</span> filename[100];</div>
<div class="line">      <span class="keywordflow">if</span> (DiffusionVectors-&gt;ElementAt(i).two_norm() &lt;=</div>
<div class="line">          0.0) <span class="comment">// this is a reference image</span></div>
<div class="line">      {</div>
<div class="line">        snprintf(filename,</div>
<div class="line">                 <span class="keyword">sizeof</span>(filename),</div>
<div class="line">                 <span class="stringliteral">&quot;ReferenceImage%d.mhd&quot;</span>,</div>
<div class="line">                 referenceImageIndex);</div>
<div class="line">        ++referenceImageIndex;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        snprintf(filename, <span class="keyword">sizeof</span>(filename), <span class="stringliteral">&quot;Gradient%d.mhd&quot;</span>, i);</div>
<div class="line">      }</div>
<div class="line">      gradientWriter-&gt;SetFileName(filename);</div>
<div class="line">      gradientWriter-&gt;Update();</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="comment">// -------------------------------------------------------------------------</span></div>
<div class="line">  <span class="keyword">auto</span> tensorReconstructionFilter =</div>
<div class="line">    <a class="code hl_function" href="itkAddImageFilter_8h.html#a3a600dc8aa7dad7b4c1e9d190d4f8c92">TensorReconstructionImageFilterType::New</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// The reference and the gradient images are conveniently provided as</span></div>
<div class="line">  <span class="comment">// input to the DiffusionTensor3DReconstructionImageFilter as</span></div>
<div class="line">  <span class="comment">//   filter-&gt;SetGradientImage( directionsContainer, nrrdreader-&gt;GetOutput()</span></div>
<div class="line">  <span class="comment">//   );</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// The output of the nrrdreader is a VectorImage (akin to a multicomponent</span></div>
<div class="line">  <span class="comment">// 3D image). The nth component image is treated as a reference image if its</span></div>
<div class="line">  <span class="comment">// corresponding gradient direction is (0,0,0). Any number of reference</span></div>
<div class="line">  <span class="comment">// images may be specified.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// An alternate way to provide the inputs, when you have the reference and</span></div>
<div class="line">  <span class="comment">// gradient images in separate itk::Image&lt; type, 3 &gt; is  :</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">//   tensorReconstructionFilter-&gt;SetReferenceImage( image0 );</span></div>
<div class="line">  <span class="comment">//   tensorReconstructionFilter-&gt;AddGradientImage( direction1, image1 );</span></div>
<div class="line">  <span class="comment">//   tensorReconstructionFilter-&gt;AddGradientImage( direction2, image2 );</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  tensorReconstructionFilter-&gt;SetGradientImage(DiffusionVectors,</div>
<div class="line">                                               reader-&gt;GetOutput());</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// This is necessary until we fix netlib/dsvdc.c</span></div>
<div class="line">  tensorReconstructionFilter-&gt;SetNumberOfWorkUnits(1);</div>
<div class="line"> </div>
<div class="line">  tensorReconstructionFilter-&gt;SetBValue(b0);</div>
<div class="line">  tensorReconstructionFilter-&gt;SetThreshold(</div>
<div class="line">    <span class="keyword">static_cast&lt;</span>TensorReconstructionImageFilterType::ReferencePixelType<span class="keyword">&gt;</span>(</div>
<div class="line">      std::stod(argv[2])));</div>
<div class="line">  tensorReconstructionFilter-&gt;Update();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="comment">// -------------------------------------------------------------------------</span></div>
<div class="line">  <span class="comment">// Write out the image of tensors. This code snippet goes to show that you</span></div>
<div class="line">  <span class="comment">// can use itk::ImageFileWriter to write an image of tensors.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keyword">using</span> TensorWriterType = <a class="code hl_class" href="classitk_1_1ImageFileWriter.html">itk::ImageFileWriter</a>&lt;</div>
<div class="line">    TensorReconstructionImageFilterType::OutputImageType&gt;;</div>
<div class="line">  <span class="keyword">auto</span> tensorWriter = <a class="code hl_function" href="itkAddImageFilter_8h.html#a3a600dc8aa7dad7b4c1e9d190d4f8c92">TensorWriterType::New</a>();</div>
<div class="line">  tensorWriter-&gt;SetFileName(argv[3]);</div>
<div class="line">  tensorWriter-&gt;SetInput(tensorReconstructionFilter-&gt;GetOutput());</div>
<div class="line">  tensorWriter-&gt;Update();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="comment">// -------------------------------------------------------------------------</span></div>
<div class="line">  <span class="comment">// Now that we have the image of tensors, we may use one of the many tensor</span></div>
<div class="line">  <span class="comment">// filters in ITK. Below, we use the TensorFractionalAnisotropyImageFilter</span></div>
<div class="line">  <span class="comment">// to compute the FA.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keyword">using</span> TensorPixelType =</div>
<div class="line">    TensorReconstructionImageFilterType::TensorPixelType;</div>
<div class="line">  <span class="keyword">using</span> RealValueType = TensorPixelType::RealValueType;</div>
<div class="line">  <span class="keyword">using</span> FAImageType = <a class="code hl_class" href="classitk_1_1Image.html">itk::Image&lt;RealValueType, Dimension&gt;</a>;</div>
<div class="line">  <span class="keyword">using</span> FAFilterType = <a id="_a12" name="_a12"></a><a class="code hl_class" href="classitk_1_1TensorFractionalAnisotropyImageFilter.html">itk::TensorFractionalAnisotropyImageFilter</a>&lt;</div>
<div class="line">    TensorReconstructionImageFilterType::OutputImageType,</div>
<div class="line">    FAImageType&gt;;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> fractionalAnisotropyFilter = <a class="code hl_function" href="itkAddImageFilter_8h.html#a3a600dc8aa7dad7b4c1e9d190d4f8c92">FAFilterType::New</a>();</div>
<div class="line">  fractionalAnisotropyFilter-&gt;SetInput(</div>
<div class="line">    tensorReconstructionFilter-&gt;GetOutput());</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Write the FA image</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keyword">using</span> FAWriterType = <a class="code hl_class" href="classitk_1_1ImageFileWriter.html">itk::ImageFileWriter&lt;FAFilterType::OutputImageType&gt;</a>;</div>
<div class="line">  <span class="keyword">auto</span> faWriter = <a class="code hl_function" href="itkAddImageFilter_8h.html#a3a600dc8aa7dad7b4c1e9d190d4f8c92">FAWriterType::New</a>();</div>
<div class="line">  faWriter-&gt;SetInput(fractionalAnisotropyFilter-&gt;GetOutput());</div>
<div class="line">  faWriter-&gt;SetFileName(argv[4]);</div>
<div class="line">  faWriter-&gt;Update();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Compute and write the Relative Anisotropy</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keyword">using</span> TensorPixelType =</div>
<div class="line">    TensorReconstructionImageFilterType::TensorPixelType;</div>
<div class="line">  <span class="keyword">using</span> RealValueType = TensorPixelType::RealValueType;</div>
<div class="line">  <span class="keyword">using</span> RAImageType = <a class="code hl_class" href="classitk_1_1Image.html">itk::Image&lt;RealValueType, Dimension&gt;</a>;</div>
<div class="line">  <span class="keyword">using</span> RAFilterType = <a id="_a13" name="_a13"></a><a class="code hl_class" href="classitk_1_1TensorRelativeAnisotropyImageFilter.html">itk::TensorRelativeAnisotropyImageFilter</a>&lt;</div>
<div class="line">    TensorReconstructionImageFilterType::OutputImageType,</div>
<div class="line">    RAImageType&gt;;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> relativeAnisotropyFilter = <a class="code hl_function" href="itkAddImageFilter_8h.html#a3a600dc8aa7dad7b4c1e9d190d4f8c92">RAFilterType::New</a>();</div>
<div class="line">  relativeAnisotropyFilter-&gt;SetInput(tensorReconstructionFilter-&gt;GetOutput());</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> RAWriterType = <a class="code hl_class" href="classitk_1_1ImageFileWriter.html">itk::ImageFileWriter&lt;RAFilterType::OutputImageType&gt;</a>;</div>
<div class="line">  <span class="keyword">auto</span> raWriter = <a class="code hl_function" href="itkAddImageFilter_8h.html#a3a600dc8aa7dad7b4c1e9d190d4f8c92">RAWriterType::New</a>();</div>
<div class="line">  raWriter-&gt;SetInput(relativeAnisotropyFilter-&gt;GetOutput());</div>
<div class="line">  raWriter-&gt;SetFileName(argv[5]);</div>
<div class="line">  raWriter-&gt;Update();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> EXIT_SUCCESS;</div>
<div class="line">}</div>
<div class="ttc" id="aclassitk_1_1ExceptionObject_html"><div class="ttname"><a href="classitk_1_1ExceptionObject.html">itk::ExceptionObject</a></div><div class="ttdoc">Standard exception handling object.</div><div class="ttdef"><b>Definition:</b> <a href="itkExceptionObject_8h_source.html#l00050">itkExceptionObject.h:51</a></div></div>
<div class="ttc" id="aclassitk_1_1ImageFileReader_html_ac90899aba4a68053e9ea5bc3860ed442"><div class="ttname"><a href="classitk_1_1ImageFileReader.html#ac90899aba4a68053e9ea5bc3860ed442">itk::ImageFileReader::New</a></div><div class="ttdeci">static Pointer New()</div></div>
<div class="ttc" id="aclassitk_1_1ImageFileWriter_html"><div class="ttname"><a href="classitk_1_1ImageFileWriter.html">itk::ImageFileWriter</a></div><div class="ttdoc">Writes image data to a single file.</div><div class="ttdef"><b>Definition:</b> <a href="itkImageFileWriter_8h_source.html#l00090">itkImageFileWriter.h:91</a></div></div>
<div class="ttc" id="aclassitk_1_1ImageRegionConstIterator_html"><div class="ttname"><a href="classitk_1_1ImageRegionConstIterator.html">itk::ImageRegionConstIterator&lt; ImageType &gt;</a></div></div>
<div class="ttc" id="aclassitk_1_1ImageRegionIterator_html"><div class="ttname"><a href="classitk_1_1ImageRegionIterator.html">itk::ImageRegionIterator</a></div><div class="ttdoc">A multi-dimensional iterator templated over image type that walks a region of pixels.</div><div class="ttdef"><b>Definition:</b> <a href="itkImageRegionIterator_8h_source.html#l00080">itkImageRegionIterator.h:81</a></div></div>
<div class="ttc" id="aclassitk_1_1Image_html"><div class="ttname"><a href="classitk_1_1Image.html">itk::Image</a></div><div class="ttdoc">Templated n-dimensional image class.</div><div class="ttdef"><b>Definition:</b> <a href="itkImage_8h_source.html#l00088">itkImage.h:89</a></div></div>
<div class="ttc" id="aclassitk_1_1MetaDataDictionary_html"><div class="ttname"><a href="classitk_1_1MetaDataDictionary.html">itk::MetaDataDictionary</a></div><div class="ttdoc">Provides a mechanism for storing a collection of arbitrary data types.</div><div class="ttdef"><b>Definition:</b> <a href="itkMetaDataDictionary_8h_source.html#l00054">itkMetaDataDictionary.h:55</a></div></div>
<div class="ttc" id="aclassitk_1_1MetaDataDictionary_html_a9b8fc0f9c50eafe40b80c61bcf6d138c"><div class="ttname"><a href="classitk_1_1MetaDataDictionary.html#a9b8fc0f9c50eafe40b80c61bcf6d138c">itk::MetaDataDictionary::GetKeys</a></div><div class="ttdeci">std::vector&lt; std::string &gt; GetKeys() const</div></div>
<div class="ttc" id="aclassitk_1_1TensorFractionalAnisotropyImageFilter_html"><div class="ttname"><a href="classitk_1_1TensorFractionalAnisotropyImageFilter.html">itk::TensorFractionalAnisotropyImageFilter</a></div><div class="ttdoc">Computes the Fractional Anisotropy for every pixel of a input tensor image.</div><div class="ttdef"><b>Definition:</b> <a href="itkTensorFractionalAnisotropyImageFilter_8h_source.html#l00069">itkTensorFractionalAnisotropyImageFilter.h:73</a></div></div>
<div class="ttc" id="aclassitk_1_1TensorRelativeAnisotropyImageFilter_html"><div class="ttname"><a href="classitk_1_1TensorRelativeAnisotropyImageFilter.html">itk::TensorRelativeAnisotropyImageFilter</a></div><div class="ttdoc">Computes the Relative Anisotropy for every pixel of a input tensor image.</div><div class="ttdef"><b>Definition:</b> <a href="itkTensorRelativeAnisotropyImageFilter_8h_source.html#l00069">itkTensorRelativeAnisotropyImageFilter.h:73</a></div></div>
<div class="ttc" id="aclassitk_1_1VectorImage_html"><div class="ttname"><a href="classitk_1_1VectorImage.html">itk::VectorImage</a></div><div class="ttdoc">Templated n-dimensional vector image class.</div><div class="ttdef"><b>Definition:</b> <a href="itkVectorImage_8h_source.html#l00081">itkVectorImage.h:82</a></div></div>
<div class="ttc" id="aitkAddImageFilter_8h_html_a3a600dc8aa7dad7b4c1e9d190d4f8c92"><div class="ttname"><a href="itkAddImageFilter_8h.html#a3a600dc8aa7dad7b4c1e9d190d4f8c92">New</a></div><div class="ttdeci">static Pointer New()</div></div>
<div class="ttc" id="aitkAddImageFilter_8h_html_ac831674d6d3f7cd2148ae944cbaa7c9d"><div class="ttname"><a href="itkAddImageFilter_8h.html#ac831674d6d3f7cd2148ae944cbaa7c9d">Pointer</a></div><div class="ttdeci">SmartPointer&lt; Self &gt; Pointer</div><div class="ttdef"><b>Definition:</b> <a href="itkAddImageFilter_8h_source.html#l00093">itkAddImageFilter.h:93</a></div></div>
<div class="ttc" id="aitkDiffusionTensor3DReconstructionImageFilter_8h_html"><div class="ttname"><a href="itkDiffusionTensor3DReconstructionImageFilter_8h.html">itkDiffusionTensor3DReconstructionImageFilter.h</a></div></div>
<div class="ttc" id="aitkImageFileWriter_8h_html"><div class="ttname"><a href="itkImageFileWriter_8h.html">itkImageFileWriter.h</a></div></div>
<div class="ttc" id="aitkImageRegionIterator_8h_html"><div class="ttname"><a href="itkImageRegionIterator_8h.html">itkImageRegionIterator.h</a></div></div>
<div class="ttc" id="aitkImageSeriesReader_8h_html"><div class="ttname"><a href="itkImageSeriesReader_8h.html">itkImageSeriesReader.h</a></div></div>
<div class="ttc" id="aitkNrrdImageIO_8h_html"><div class="ttname"><a href="itkNrrdImageIO_8h.html">itkNrrdImageIO.h</a></div></div>
<div class="ttc" id="aitkTensorFractionalAnisotropyImageFilter_8h_html"><div class="ttname"><a href="itkTensorFractionalAnisotropyImageFilter_8h.html">itkTensorFractionalAnisotropyImageFilter.h</a></div></div>
<div class="ttc" id="aitkTensorRelativeAnisotropyImageFilter_8h_html"><div class="ttname"><a href="itkTensorRelativeAnisotropyImageFilter_8h.html">itkTensorRelativeAnisotropyImageFilter.h</a></div></div>
<div class="ttc" id="anamespaceitk_1_1GTest_1_1TypedefsAndConstructors_1_1Dimension2_html_a3c1343e7d285fc01106df9e0c28d5154"><div class="ttname"><a href="namespaceitk_1_1GTest_1_1TypedefsAndConstructors_1_1Dimension2.html#a3c1343e7d285fc01106df9e0c28d5154">itk::GTest::TypedefsAndConstructors::Dimension2::Dimension</a></div><div class="ttdeci">constexpr unsigned int Dimension</div><div class="ttdef"><b>Definition:</b> <a href="itkGTestTypedefsAndConstructors_8h_source.html#l00044">itkGTestTypedefsAndConstructors.h:44</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<hr class="footer"/>
<div class="footer" align="left">
  <small>Tarballs of the nightly generated Doxygen documentation are available
    for the
    <a href="https://itk.org/files/NightlyDoxygen/InsightDoxygenDocHtml.tar.gz">html</a>,
    <a href="https://itk.org/files/NightlyDoxygen/InsightDoxygenDocXml.tar.gz">xml</a>, and
    <a href="https://itk.org/files/NightlyDoxygen/InsightDoxygenDocTag.gz">tag file</a>.
  Previous versions of this documentation for version:
    <a href="https://itk.org/Doxygen53/html/index.html">5.3</a>,
    <a href="https://itk.org/Doxygen52/html/index.html">5.2</a>,
    <a href="https://itk.org/Doxygen51/html/index.html">5.1</a>,
    <a href="https://itk.org/Doxygen50/html/index.html">5.0</a>,
    <a href="https://itk.org/Doxygen413/html/index.html">4.13</a>,
    <a href="https://itk.org/Doxygen320/html/index.html">3.20</a>.
  </small>
</div>
<address class="footer"><small>
Generated on <span id="datetime">unknown</span> for ITK by &#160;
<a href="https://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.9.3
</small></address>
</body>
</html>
